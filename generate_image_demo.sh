#!/bin/bash

echo "üé® –î–µ–º–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ Kandinsky API"
echo "================================================"

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

SERVER_URL="http://localhost:8080"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
generate_image() {
    local prompt="$1"
    local style="$2"
    local width="$3"
    local height="$4"
    local negative_prompt="$5"

    echo -e "${BLUE}üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...${NC}"
    echo "üìù –ü—Ä–æ–º–ø—Ç: $prompt"
    echo "üé≠ –°—Ç–∏–ª—å: $style"
    echo "üìê –†–∞–∑–º–µ—Ä: ${width}x${height}"

    if [ ! -z "$negative_prompt" ]; then
        echo "üö´ –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç: $negative_prompt"
    fi

    # –°–æ–∑–¥–∞–µ–º JSON –∑–∞–ø—Ä–æ—Å
    json_data=$(cat <<EOF
{
  "prompt": "$prompt",
  "style": "$style",
  "width": $width,
  "height": $height,
  "negativePrompt": "$negative_prompt"
}
EOF
)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
    response=$(curl -s -X POST "$SERVER_URL/api/generate-image" \
        -H "Content-Type: application/json" \
        -d "$json_data")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
    if echo "$response" | grep -q '"success":true'; then
        echo -e "${GREEN}‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ!${NC}"

        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
        image_url=$(echo "$response" | grep -o '"imageUrl":"[^"]*"' | sed 's/"imageUrl":"//;s/"$//')
        file_name=$(echo "$response" | grep -o '"fileName":"[^"]*"' | sed 's/"fileName":"//;s/"$//')

        echo "üñºÔ∏è  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏:"
        echo "   ‚Ä¢ –õ–æ–∫–∞–ª—å–Ω—ã–π URL: $SERVER_URL$image_url"
        echo "   ‚Ä¢ –ò–º—è —Ñ–∞–π–ª–∞: $file_name"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–Ω–æ –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        if curl -s -I "$SERVER_URL$image_url" | grep -q "200 OK"; then
            echo -e "${GREEN}   ‚Ä¢ –§–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è${NC}"
        else
            echo -e "${YELLOW}   ‚Ä¢ –§–∞–π–ª –µ—â–µ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)${NC}"
        fi

    else
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è${NC}"
        echo "–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:"
        echo "$response"
    fi

    echo ""
}

# –ü—Ä–∏–º–µ—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
echo "üåÖ –ü—Ä–∏–º–µ—Ä 1: –ö—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç"
generate_image \
    "–∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –æ–∫–µ–∞–Ω–æ–º, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ —Ñ–æ—Ç–æ, –∑–æ–ª–æ—Ç–∏—Å—Ç—ã–µ –æ–±–ª–∞–∫–∞" \
    "DEFAULT" \
    1024 \
    768 \
    "–ª—é–¥–∏, —Ç–µ–∫—Å—Ç, –∞–≤—Ç–æ–º–æ–±–∏–ª–∏"

echo "üèîÔ∏è  –ü—Ä–∏–º–µ—Ä 2: –ì–æ—Ä–Ω—ã–π –ø–µ–π–∑–∞–∂"
generate_image \
    "–≤–µ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥–æ—Ä—ã —Å –∑–∞—Å–Ω–µ–∂–µ–Ω–Ω—ã–º–∏ –≤–µ—Ä—à–∏–Ω–∞–º–∏, –∞–ª—å–ø–∏–π—Å–∫–∏–µ –ª—É–≥–∞" \
    "DEFAULT" \
    1024 \
    1024 \
    "–ª—é–¥–∏, –∑–¥–∞–Ω–∏—è, –¥–æ—Ä–æ–≥–∏"

echo "üåå –ü—Ä–∏–º–µ—Ä 3: –ö–æ—Å–º–æ—Å"
generate_image \
    "–≥–ª—É–±–æ–∫–∏–π –∫–æ—Å–º–æ—Å —Å –≥–∞–ª–∞–∫—Ç–∏–∫–∞–º–∏ –∏ –∑–≤–µ–∑–¥–∞–º–∏, –∞—Å—Ç—Ä–æ—Ñ–æ—Ç–æ" \
    "DEFAULT" \
    1024 \
    1024 \
    "–ø–ª–∞–Ω–µ—Ç—ã, —Ç–µ–∫—Å—Ç"

echo "üé≠ –ü—Ä–∏–º–µ—Ä 4: –§—ç–Ω—Ç–µ–∑–∏"
generate_image \
    "–≤–æ–ª—à–µ–±–Ω—ã–π –ª–µ—Å —Å –µ–¥–∏–Ω–æ—Ä–æ–≥–∞–º–∏ –∏ —Å–≤–µ—Ç–ª—è—á–∫–∞–º–∏, —Ñ—ç–Ω—Ç–µ–∑–∏ –∞—Ä—Ç" \
    "ANIME" \
    768 \
    768 \
    "—Ç–µ–º–Ω—ã–µ —Ç–æ–Ω–∞, —Å—Ç—Ä–∞—Ö"

echo "üèôÔ∏è  –ü—Ä–∏–º–µ—Ä 5: –ö–∏–±–µ—Ä–ø–∞–Ω–∫ –≥–æ—Ä–æ–¥"
generate_image \
    "–∫–∏–±–µ—Ä–ø–∞–Ω–∫ –º–µ–≥–∞–ø–æ–ª–∏—Å –Ω–æ—á—å—é, –Ω–µ–æ–Ω–æ–≤—ã–µ –æ–≥–Ω–∏, —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞" \
    "UHD" \
    1024 \
    768 \
    "–ª—é–¥–∏, –∞–≤—Ç–æ–º–æ–±–∏–ª–∏, —Ç–µ–∫—Å—Ç"

echo ""
echo -e "${GREEN}üéâ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!${NC}"
echo ""
echo "üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:"
echo "   ‚Ä¢ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: $SERVER_URL/generate"
echo "   ‚Ä¢ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: $SERVER_URL/"
echo "   ‚Ä¢ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ 'images/'"
echo ""
echo "üí° –°–æ–≤–µ—Ç—ã:"
echo "   ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ"
echo "   ‚Ä¢ –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"
echo "   ‚Ä¢ –†–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–∞—é—Ç —Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (DEFAULT, KANDINSKY, UHD, ANIME)"
echo "   ‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 2048x2048 –ø–∏–∫—Å–µ–ª–µ–π"
